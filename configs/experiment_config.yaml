# Experiment setup
experiment_name: "infineon_void_poc"
experiment_dir: "data/experiments/infineon_void_poc"

# Base data
base_image_dir: "data/base_chips"  # 5 NoVoids images

# Model settings
dino_model: "dinov2_vitb14"        # 768-dim embeddings
pca_embedding_dim: 400             # reduce to 400-dim for optimization
pca_visualization_dim: 2           # further reduce to 2D for visualization

# Random seed (one seed to rule them all)
random_seed: 42

# Dataset sizes
real:
  param_sets: 10
  replications: 5

close:
  param_sets: 10
  replications: 50

far:
  param_sets: 10
  replications: 50

# Iteration settings
iteration_batch_size: 10      # param sets per iteration
replications_per_iteration: 20
max_iterations: 10

# Initial condition for optimization (iteration 0)
initial_condition: 'far'  # 'close' or 'far' - determines starting synthetic distribution

# Parameter precision (decimal places for rounding)
# Controls granularity of parameter space for optimization
# precision=1 means round to 1 decimal place (step size 0.1)
# precision=2 means round to 2 decimal places (step size 0.01)
param_precision:
  base_size: 1          # round(15.347, 1) = 15.3  (step size: 0.1 pixels)
  rotation: 1           # round(123.456, 1) = 123.5 (step size: 0.1 degrees)
  center_x: 2           # round(0.4567, 2) = 0.46  (step size: 0.01)
  center_y: 2           # round(0.4567, 2) = 0.46  (step size: 0.01)
  position_spread: 2    # round(0.4567, 2) = 0.46  (step size: 0.01)

# Distribution parameter bounds (for optimizer to suggest distribution moments)
# These bounds define the search space for distribution parameters
distribution_param_bounds:
  void_shape:
    # Logit bounds for softmax transformation (unconstrained space)
    logit_range: [-3.0, 3.0]  # Will be transformed to probabilities via softmax
  void_count:
    mean: [1, 10]     # Integer mean of distribution
    std: [0.5, 5.0]   # Standard deviation
  base_size:
    mean: [5.0, 15.0]  # Mean void size
    std: [0.5, 5.0]    # Size variation
  rotation:
    mean: [0.0, 360.0]  # Mean rotation angle
    std: [10.0, 180.0]  # Rotation variation
  center_x:
    mean: [0.2, 0.8]   # Mean x position
    std: [0.05, 0.3]   # Position variation
  center_y:
    mean: [0.2, 0.8]   # Mean y position
    std: [0.05, 0.3]   # Position variation
  position_spread:
    mean: [0.1, 0.8]   # Mean spread
    std: [0.05, 0.3]   # Spread variation

# Parameter distributions (initial guesses, tune empirically)
# Note: Sampling will clip to distribution_param_bounds defined above
param_distributions:
  real:
    void_shape:
      probabilities:
        circle: 0.2
        ellipse: 0.5
        irregular: 0.3
    void_count:
      mean: 4
      std: 3
    base_size:
      mean: 10
      std: 3
    rotation:
      mean: 180
      std: 90
    center_x:
      mean: 0.5
      std: 0.15
    center_y:
      mean: 0.5
      std: 0.15
    position_spread:
      mean: 0.5
      std: 0.15

  close:
    void_shape:
      probabilities:
        circle: 0.25
        ellipse: 0.45
        irregular: 0.3
    void_count:
      mean: 10
      std: 3
    base_size:
      mean: 18
      std: 5
    rotation:
      mean: 180
      std: 90
    center_x:
      mean: 0.5
      std: 0.15
    center_y:
      mean: 0.5
      std: 0.15
    position_spread:
      mean: 0.55
      std: 0.15

  far:
    void_shape:
      probabilities:
        circle: 0.1
        ellipse: 0.1
        irregular: 0.8
    void_count:
      mean: 20
      std: 3
    base_size:
      mean: 4
      std: 2
    rotation:
      mean: 45
      std: 20
    center_x:
      mean: 0.7
      std: 0.15
    center_y:
      mean: 0.1
      std: 0.15
    position_spread:
      mean: 0.95
      std: 0.05

# Optimization metrics
# List of metrics to optimize (order matters - first metric is primary)
# Available metrics: mmd_rbf, mmd_linear, wasserstein, mean_nn_distance, median_nn_distance
optimization_metrics:
  - mmd_rbf
  - mean_nn_distance

# Convergence criteria
convergence_threshold: 0.05  # distribution similarity metric
early_stop_patience: 3       # stop if no improvement for N iterations

# Optimization (placeholder)
acquisition_function: "ucb"  # or "ei", "pi"
